<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.demo.mybatis.mapper.UserMapper">
<!-- 查询用户和购买的商品，这里用不了继承 -->
<resultMap type="User" id="UserAndItemsResultMap">
    <!-- 用户信息 -->
    <id column="user_id" property="id"/>
    <result column="username" property="username"/>
    <result column="sex" property="sex"/>
    <result column="address" property="address"/>
    <!-- 用户购买的订单信息一个用户对应多个订单，使用collection -->
    <collection property="ordersList" ofType="Orders">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="number" property="number"/>
        <result column="createtime" property="createtime"/>
        <result column="note" property="note"/>
        
        <!-- 订单明细，一个订单有多个订单明细 -->
        <collection property="orderdetails" ofType="Orderdetail">
            <id column="orderdetail_id" property="id"/>
            <result column="items_id" property="itemsId"/>
            <result column="items_num" property="itemsNum"/>
            <result column="orders_id" property="ordersId"/>
            <result column="items_id" property="itemsId"/>
            
            <!-- 商品，一个订单明细对应一个商品 -->
            <association property="items" javaType="Items">
                <id column="items_id" property="id"/>
                <result column="items_name" property="name"/>
                <result column="items_detail" property="detail"/>
                <result column="items_price" property="price"/>
            </association>
        </collection>   
    </collection>
</resultMap>

<!-- 查询用户和购买的商品信息，使用resultMap -->
<select id="findUserAndItems" resultMap="UserAndItemsResultMap">
    SELECT  orders.*, user.username, user.sex,user.address, orderdetail.id orderdetail_id,
            orderdetail.items_id, orderdetail.items_num, orderdetail.orders_id,
            items.name items_name, items.detail items_detail, items.price items_price
    FROM orders , USER , orderdetail , items
    WHERE orders.user_id = user.id AND orderdetail.orders_id = orders.id AND orderdetail.items_id = items.id
</select>
</mapper>